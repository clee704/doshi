"use strict";angular.module("doshi",["ngRoute","ngAnimate"]).config(["$logProvider",function(a){a.debugEnabled(!1)}]),angular.module("doshi").controller("CoursesAndClassesInputCtrl",["$scope","problemArgs","appService",function(a,b,c){a.page=a.getCurrentPage(),a.courses=b.courses,a.classes=b.classes,a._problemArgs=b,a.loadExample=function(){c.loadExample()},a.addCourse=function(){c.addCourse(a.newCourse),a.newCourse=""},a.removeCourse=function(a){c.removeCourse(a)},a.addClass=function(){c.addClass(a.newClass),a.newClass=""},a.removeClass=function(a){c.removeClass(a)},a.$watch("courses",c.onDataChange,!0),a.$watch("classes",c.onDataChange,!0),a.$watch("_problemArgs.inputTimetable",c.onDataChange,!0),a.$watch("_problemArgs.maxClasses",c.onDataChange),a.$watch("_problemArgs.courseHours",c.onDataChange),a.$watch("_problemArgs.courseHoursByCourse",c.onDataChange,!0)}]).animation(".list-group-item",["getCssRule",function(a){var b=".input-courses-and-classes .list-group-item:not(.empty).ng-leave",c=a(b);return{leave:function(a,b){a.is(":not(.empty)")&&c&&(c.style.height=a.height()+"px"),b()}}}]),angular.module("doshi").controller("TimesInputCtrl",["$scope","problemArgs","appService","screenclick",function(a,b,c,d){function e(){null!==a.selectedCell&&(a.selectedCell.isSelected=!1,a.selectedCell=null)}a.page=a.getCurrentPage(),a.days=c.days,a.periods=c.periods,a.inputTimetable=b.inputTimetable,a.courses=b.courses,a.classes=b.classes,a.selectedCell=null,a.select=function(b){e(),b.isSelected=!0,a.selectedCell=b},a.toggleClass=function(a,b){var c=a[0];if(c){var d=c.indexOf(b);if(-1===d)c.push(b);else{c.splice(d,1);var e=a[1];0===c.length&&e&&(e.length=0)}}else c=a[0]=[b];c.sort()},a.toggleCourse=function(a,b){var c=a[1];if(c){var d=c.indexOf(b);-1===d?c.push(b):c.splice(d,1)}else c=a[1]=[b];c.sort()},a.resetInputTimetable=function(){c.forEachInputCell(function(a){a.length=0})},d(function(){a.$apply(e)}),a.$watch("inputTimetable",c.onDataChange,!0)}]),angular.module("doshi").controller("EtcInputCtrl",["$scope","problemArgs","appService",function(a,b,c){a.page=a.getCurrentPage(),a.problemArgs=b,a.$watch("problemArgs.maxClasses",c.onDataChange),a.$watch("problemArgs.courseHours",c.onDataChange),a.$watch("problemArgs.courseHoursByCourse",c.onDataChange,!0)}]),angular.module("doshi").config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/input-step1.html",controller:"CoursesAndClassesInputCtrl",routeName:"Step 1"}).when("/input-times",{templateUrl:"views/input-step2.html",controller:"TimesInputCtrl",routeName:"Step 2"}).when("/input-etc",{templateUrl:"views/input-step3.html",controller:"EtcInputCtrl",routeName:"Step 3"}).when("/output",{templateUrl:"views/output.html",controller:"OutputCtrl",routeName:"Output"}).otherwise({redirectTo:"/"})}]).controller("NavCtrl",["$scope","$location",function(a,b){a.pages=[{path:"/",title:"교과목/반 입력"},{path:"/input-times",title:"시간 입력"},{path:"/input-etc",title:"기타 설정"},{path:"/output",title:"시간표 만들기"}],a.pageTransitionDirection="forward";var c,d=mapObj(a.pages.map(function(a){return a.path}),function(a,b){return b});!function(){for(var b=0;b<a.pages.length;b++){var c=a.pages[b];b>0&&(c.prevPage=a.pages[b-1]),b<a.pages.length-1&&(c.nextPage=a.pages[b+1])}}(),a.$on("$locationChangeSuccess",function(){var e=b.path(),f=d[c],g=d[e];a.pageTransitionDirection=void 0===f||g>=f?"forward":"backward",c=e,a.path=e}),a.getCurrentPage=function(){return a.pages[d[b.path()]]}}]).animation(".view",["getCssRule","scrollTo",function(a,b){function c(a){return function(c,d){var f,g=c.parent().is(".forward"),h=angular.element(".container").outerWidth();f=g&&a||!g&&!a?"translate("+h+"px, 0)":"translate(-"+h+"px, 0)";var i=g?a?0:1:a?2:3,j=e[i];j&&(j.style["-webkit-transform"]=f,j.style["-ms-transform"]=f,j.style.transform=f),a||c.on("transitionend",function(){b(".view-wrapper",{direction:"upward"})}),d()}}var d=[".forward .view.ng-enter",".forward .view.ng-leave.ng-leave-active",".backward .view.ng-enter",".backward .view.ng-leave.ng-leave-active"],e=d.map(a);return{enter:c(!0),leave:c(!1)}}]),angular.module("doshi").controller("OutputCtrl",["$scope","appService","screenclick",function(a,b,c){function d(){a.highlightedCourse=void 0,a.highlightedClass=void 0,b.forEachAssignment(function(a){a.isHighlighted=!1})}a.page=a.getCurrentPage(),a.days=b.days,a.periods=b.periods,a.status=b.status,a.timetable=b.timetable,a.timetableStats=b.timetableStats,a.highlightedCourse=void 0,a.highlightedClass=void 0,a.start=function(){b.start()},a.pause=function(){b.pause()},a.resume=function(){b.resume()},a.highlightCourse=function(c){a.highlightedCourse=c,a.highlightedClass=void 0,b.forEachAssignment(function(a){a.isHighlighted=a[0]===c})},a.highlightClass=function(c){a.highlightedCourse=void 0,a.highlightedClass=c,b.forEachAssignment(function(a){a.isHighlighted=!1;for(var b=a[1],d=0;d<b.length;d++)if(b[d]===c){a.isHighlighted=!0;break}})},c(function(){a.$apply(d)}),d()}]),angular.module("doshi").directive("maximizeHeight",["$window","$timeout","debounce",function(a,b,c){var d={};return angular.element(a).on("resize",c(function(){for(var a in d)d.hasOwnProperty(a)&&d[a]()},400)),{link:function(a,c,e){function f(){c.hasClass("height-maximized")&&c.css("height","").removeClass("height-maximized"),b(function(){if(!e.resizeIf||a.$eval(e.resizeIf)){var b=c.height(),d=c.parent().height()+1;b!==d&&c.css("height",d+"px").addClass("height-maximized")}})}d[a.$id]=f,a.$on("$destroy",function(){delete d[a.$id]}),a.$watch(e.watch,f,!0)}}}]),angular.module("doshi").directive("ngConfirm",["$window","$parse",function(a,b){return{link:function(c,d,e){var f=b(e.ngConfirm);d.on("click",function(b){var d=a.confirm("입력된 정보를 모두 지우시겠습니까?");d&&c.$apply(function(){f(c,{$event:b})})})}}}]),angular.module("doshi").directive("ngEnter",["$parse",function(a){return{link:function(b,c,d){var e=a(d.ngEnter);c.on("keypress",function(a){(13===a.which||10===a.which)&&b.$apply(function(){e(b,{$event:a})})})}}}]),angular.module("doshi").directive("progressBar",function(){return{scope:{value:"=model"},templateUrl:"templates/progress-bar.html"}}),angular.module("doshi").directive("removeOutline",function(){return{link:function(a,b){b.on("click",function(a){a.clientX>0&&a.clientY>0&&b.blur()})}}}),angular.module("doshi").service("appService",["$window","$timeout","Solver","problemArgs","localStorage","NUM_DAYS","NUM_PERIODS",function(a,b,c,d,e,f,g){function h(){var a=function(){return 0},b={daysByCourse:mapObj(d.courses,function(){return mapObj(i.days,a)}),sumDaysByCourse:mapObj(d.courses,a),coursesByClass:mapObj(d.classes,function(){return mapObj(d.courses,a)}),sumCoursesByClass:mapObj(d.classes,a)};i.forEachAssignment(function(a,c){var d=a[0],e=a[1];b.daysByCourse[d][c]+=1,b.sumDaysByCourse[d]+=1;for(var f=0;f<e.length;f++){var g=e[f];b.coursesByClass[g][d]+=1,b.sumCoursesByClass[g]+=1}}),angular.copy(b,i.timetableStats)}var i=this;i.version=0,i.days=range(f),i.periods=range(g),i.solver=new c;var j=i.status={emptyInput:!0,inputChanged:!1,showHelp:!0,starting:!1,running:!1,pausing:!1,paused:!1,finished:!0,progress:{current:0,max:0,percent:0}};i.timetable=[],i.timetableStats={daysByCourse:{},coursesByClass:{}},i.exampleData={courses:["국어","수학","직업","체육"],classes:["1-3","1-4","2-2","2-7","3-6","3-7"],inputTimetable:[[[["1-3"],["국어","수학"]],[["1-3","2-7","3-6","3-7"]],[["2-7","3-6"]],[["3-7"]],[],[],[]],[[["3-6"]],[],[],[["1-3","2-7"]],[["2-2"]],[["2-2","3-7"]],[["2-2"]]],[[],[],[],[],[["1-4","3-7"]],[["1-4","2-7"]],[]],[[["1-4","2-2","3-6","3-7"]],[["2-2","2-7","3-6"]],[],[],[["1-4"]],[["2-7"]],[["1-3","2-7","3-7"]]],[[["2-2","3-7"]],[["1-3","1-4"]],[["1-3","2-2","2-7","3-6"]],[["1-4"]],[["1-3","2-7"]],[["1-3","2-7","3-7"]],[]]],maxClasses:2,courseHours:9,courseHoursByCourse:{}},i.loadExample=function(){angular.copy(i.exampleData.courses,d.courses),angular.copy(i.exampleData.classes,d.classes),angular.copy(i.exampleData.inputTimetable,d.inputTimetable),i.status.emptyInput=isDeepEmpty(d.inputTimetable),d.maxClasses=i.exampleData.maxClasses,d.courseHours=i.exampleData.courseHours,angular.copy(i.exampleData.courseHoursByCourse,d.courseHoursByCourse)},i.onDataChange=function(a,b){a!==b&&(j.emptyInput=isDeepEmpty(d.inputTimetable),(i.timetable.length||j.running||j.paused)&&(j.inputChanged=!0),i.save())},i.save=function(){var a={version:i.version,status:i.status,timetable:i.timetable,timetableStats:i.timetableStats,problemArgs:d};e.dump("appService.savedData",a)},i.load=function(){var a=e.load("appService.savedData");if(null!==a){if(a.version!==i.version)return e.removeItem("appService.savedData"),void 0;angular.copy(a.problemArgs,d),angular.copy(a.timetable,i.timetable),angular.copy(a.timetableStats,i.timetableStats),i.status.emptyInput=a.status.emptyInput,i.status.inputChanged=a.status.inputChanged,i.status.showHelp=a.status.showHelp,i.timetable.length||(i.status.inputChanged=!1)}},i.addCourse=function(a){a&&-1===d.courses.indexOf(a)&&(d.courses.push(a),d.courses.sort())},i.removeCourse=function(a){var b=d.courses.indexOf(a);if(-1!==b){d.courses.splice(b,1);var c=function(b){return a!==b};i.forEachInputCell(function(a){var b=a[1];b&&angular.copy(b.filter(c),b)}),delete d.courseHoursByCourse[a]}},i.addClass=function(a){a&&-1===d.classes.indexOf(a)&&(d.classes.push(a),d.classes.sort())},i.removeClass=function(a){var b=d.classes.indexOf(a);if(-1!==b){d.classes.splice(b,1);var c=function(b){return a!==b};i.forEachInputCell(function(a){var b=a[0];if(b){angular.copy(b.filter(c),b);var d=a[1];0===b.length&&d&&(d.length=0)}})}},i.start=function(){(j.finished||j.paused)&&(i.timetable.length=0,j.inputChanged=!1,j.showHelp=!1,j.starting=!0,j.running=!1,j.pausing=!1,j.paused=!1,j.finished=!1,j.progress.current=0,j.progress.max=0,j.progress.percent=0,i.solver.start())},i.pause=function(){j.running&&(j.starting=!1,j.running=!1,j.pausing=!0,j.paused=!1,j.finished=!1,i.solver.pause())},i.resume=function(){j.paused&&(j.showHelp=!1,j.starting=!0,j.running=!1,j.pausing=!1,j.paused=!1,j.finished=!1,i.solver.resume())},i.forEachInputCell=function(a){for(var b=0;b<d.inputTimetable.length;b++){var c=d.inputTimetable[b];if(c)for(var e=0;e<c.length;e++){var f=c[e];f&&a.call(void 0,f)}}},i.forEachAssignment=function(a){for(var b=0;b<i.timetable.length;b++){var c=i.timetable[b];if(c)for(var d=0;d<c.length;d++){var e=c[d];if(e)for(var f=0;f<e.length;f++){var g=e[f];g&&a.call(void 0,g,b,d)}}}},i.solver.on({started:function(){b(function(){j.starting&&(j.starting=!1,j.running=!0,j.pausing=!1,j.paused=!1,j.finished=!1)})},resumed:function(){b(function(){j.starting&&(j.starting=!1,j.running=!0,j.pausing=!1,j.paused=!1,j.finished=!1)})},paused:function(){b(function(){j.pausing&&(j.starting=!1,j.running=!1,j.pausing=!1,j.paused=!0,j.finished=!1)})},progress:function(a,c){b(function(){j.progress.current=a,j.progress.max=c,j.progress.percent=a/c*100})},solutionfound:function(a,c){b(function(){j.running&&(j.starting=!1,j.running=!1,j.pausing=!1,j.paused=!1,j.finished=!0,angular.copy(c,i.timetable),h(),i.save())})},unsolvableproblem:function(){a.alert("조건에 맞는 시간표를 만들 수 없습니다. 최대 수업 크기를 늘리거나 제한을 없앤 뒤 다시 시도해보세요.")}}),i.load()}]),angular.module("doshi").constant("NUM_DAYS",5).constant("NUM_PERIODS",7),angular.module("doshi").factory("debounce",["$timeout","time",function(a,b){return function(c,d){function e(){var h=arguments,i=b();void 0===g||g+d>i?(void 0!==f&&a.cancel(f),f=a(function(){e.apply(void 0,h)},d),g=i):(c.apply(void 0,h),g=void 0)}var f,g;return e}}]),angular.module("doshi").factory("getCssRule",["$window","$log",function(a,b){function c(a){var b=e.insertRule(a+"{}",e.cssRules.length),c=e.cssRules[b].selectorText;return e.deleteRule(b),c}var d=a.document.createElement("style");a.document.head.appendChild(d);var e=d.sheet;return function(d){d=c(d);for(var e=a.document.styleSheets,f=0;f<e.length;f++)for(var g=e[f],h=g.cssRules,i=0;i<h.length;i++){var j=h[i];if(j.type===CSSRule.STYLE_RULE&&j.selectorText===d)return j}b.warn("CSS rule for `"+d+"` not found")}}]),angular.module("doshi").service("localStorage",["$window",function(a){var b=a.localStorage;this.getLength=function(){return b.length},this.key=function(a){return b.key(a)},this.getItem=function(a){return b.getItem(a)},this.setItem=function(a,c){return b.setItem(a,c)},this.removeItem=function(a){return b.removeItem(a)},this.clear=function(){return b.clear()},this.dump=function(a,c){return b.setItem(a,angular.toJson(c))},this.load=function(a,c){var d=b.getItem(a);if(null!==d)try{return angular.fromJson(d)}catch(e){}return void 0!==c?c:null}}]),angular.module("doshi").service("problemArgs",["NUM_DAYS","NUM_PERIODS",function(a,b){this.courses=[],this.classes=[],this.inputTimetable=range(a).map(function(){return range(b).map(function(){return[]})}),this.maxClasses=null,this.courseHours=null,this.courseHoursByCourse={}}]),angular.module("doshi").service("random",function(){var a=this;a.uniform=function(){return Math.random()},a.choice=function(b,c){for(var d=a.uniform(),e=0,f=0;f<b.length;f++)if(e+=c[f],e>d)return b[f]}}),angular.module("doshi").factory("screenclick",["$window",function(a){var b=[];return angular.element(a).on("click",function(a){for(var c=0;c<b.length;c++)b[c].call(this,a)}),function(a){b.push(a)}}]),angular.module("doshi").factory("scrollTo",function(){return function(a,b){void 0===b&&(b={});var c=angular.element(a),d=angular.element("body"),e=c.offset().top-15,f=d.scrollTop();"upward"===b.direction&&e>f||d.animate({scrollTop:e},"fast")}}),angular.module("doshi").directive("skipNgAnimate",["$animate",function(a){return{compile:function(b){a.enabled(!1,b)}}}]),angular.module("doshi").factory("Solver",["$timeout","$log","problemArgs","time","random","localStorage",function(a,b,c,d,e,f){function g(){this._workerManager=new h({onStarted:this.onStarted.bind(this),onResumed:this.onResumed.bind(this),onPaused:this.onPaused.bind(this),onResult:this.onResult.bind(this)}),this._numSolved=0,this._numMaxRun=1e3,this._startTime=null,this._minFitness=null,this._bestTimetable=null,this._callbacks={}}function h(a){this._callbacks=a,this._problemArgs=null,this._state="init",this._scale=1,this._workers=[],this._duration=10,this._rate=0,this._alpha=1.1,this._beta=1.15,this._probabilities=[0,1,0],this._timer=null,this._numProblemSolved=0,this._load()}function i(a,b){this.running=!1,this.paused=!1,this._raw=new Worker("scripts/9f010c1a.worker.js"),this._raw.addEventListener("message",this._onMessage.bind(this),!1),this._raw.addEventListener("error",this._onError.bind(this),!1),this._manager=a,this._name=b}return g.prototype.start=function(){b.debug("Solver started!");var a={courses:c.courses,classes:c.classes,inputTimetable:c.inputTimetable,maxClasses:c.maxClasses,courseHours:this._getCourseHours()};try{this.problem=new Problem(a)}catch(e){return this._callback("unsolvableproblem",e),void 0}this._workerManager.setProblem(a),this._numSolved=0,this._minFitness=null,this._bestTimetable=null,this._startTime=d(),this._workerManager.start()},g.prototype.resume=function(){this._workerManager.resume()},g.prototype.pause=function(){this._workerManager.pause()},g.prototype._getCourseHours=function(){var a,b,d=c.courseHoursByCourse,e=!1,f=[],g=0;for(a in d)d.hasOwnProperty(a)&&(b=d[a],void 0!==b&&null!==b&&(e=!0,f.push(b),g+=b));if(!e)return c.courseHours;if(f.length===c.courses.length)return d;for(var h=null!==c.courseHours?c.courseHours:Math.round(g/f.length),i=0;i<c.courses.length;i++)a=c.courses[i],b=d[a],(void 0===b||null===b)&&(d[a]=h);return d},g.prototype.on=function(a){for(var b in a)a.hasOwnProperty(b)&&(this._callbacks[b]=a[b])},g.prototype._callback=function(){var a=[].slice.call(arguments),b=a[0],c=a.slice(1);this._callbacks[b].apply(void 0,c)},g.prototype.onStarted=function(){this._callback("started")},g.prototype.onResumed=function(){this._callback("resumed")},g.prototype.onPaused=function(){this._callback("paused")},g.prototype.onResult=function(a,c){this._numSolved+=1,(null===this._minFitness||this.problem.compareFitness(a,this._minFitness)<=0)&&(this._minFitness=a,this._bestTimetable=c,this._printSolutionInfo()),this._callback("progress",this._numSolved,this._numMaxRun),this._numSolved===this._numMaxRun&&(this._workerManager.stop(),this._callback("solutionfound",this._minFitness,this.problem.convertTimetable(this._bestTimetable)),b.debug("Solution found!"),this._printSolutionInfo())},g.prototype._printSolutionInfo=function(){var a=(d()-this._startTime)/1e3;b.debug("--- elapsed time: "+a.toFixed(6)+", num solved: "+this._numSolved+", rate: "+(this._numSolved/a).toFixed(6)+", fitness: "+this._minFitness)},h.prototype.setProblem=function(a){for(var b=0;b<this._workers.length;b++)this._workers[b].setProblem(a);this._problemArgs=a},h.prototype.start=function(){this._resume("onStarted")},h.prototype.resume=function(){this._resume("onResumed")},h.prototype._resume=function(a){this._startStateMachine(),this._callbacks[a]()},h.prototype.pause=function(){this._stopStateMachine()},h.prototype.stop=function(){for(this._stopStateMachine();this._workers.length;)this._removeWorker()},h.prototype._startStateMachine=function(){function c(){var f=d._numProblemSolved/d._duration;b.debug("state "+d._state+" has ended."),"init"!==d._state&&(b.debug("rate: "+f),b.debug("previous rate: "+d._rate));var g;switch(d._state){case"init":g="stable";break;case"stable":f>d._rate*d._beta?d._updateProbabilities(0,.05,0):f*d._beta<d._rate&&d._updateProbabilities(0,0,.05),g=e.choice(["stable","up","down"],d._probabilities),1===d._scale&&"down"===g&&(g="up"),"up"===g?d._scaleUp():"down"===g&&d._scaleDown(),d._rate=f;break;case"up":f>d._rate*d._alpha?(g=d._state,d._scale=d._workers.length,d._scaleUp(),d._rate=f):(g="stable",d._scaleDown(),d._updateProbabilities(.93,.01,.06));break;case"down":f*d._alpha>d._rate?(g=d._state,d._scale=d._workers.length,d._scaleDown(),d._rate=f):(g="stable",d._scaleUp(),d._updateProbabilities(.93,.06,.01))}d._state=g,d._numProblemSolved=0,d._save(),b.debug("###"),b.debug("state "+d._state+" is running..."),b.debug("scale: "+d._scale),b.debug("workers: "+d._workers.length),"stable"===d._state&&b.debug("probabilities: "+d._probabilities),d._timer=a(c,1e3*d._duration)}var d=this;d._state="init",d._numProblemSolved=0,d._scaleReset();for(var f=0;f<d._workers.length;f++)d._workers[f].start();this._timer=a(c,5e3)},h.prototype._stopStateMachine=function(){a.cancel(this._timer);for(var b=0;b<this._workers.length;b++)this._workers[b].pause()},h.prototype._addWorker=function(){var a=new i(this,"worker-"+this._workers.length);return a.setProblem(this._problemArgs),this._workers.push(a),a},h.prototype._removeWorker=function(){var a=this._workers.pop();a.terminate()},h.prototype._scaleUp=function(){b.debug("scaling up...");var a=this._addWorker();a.start()},h.prototype._scaleDown=function(){b.debug("scaling down..."),this._removeWorker()},h.prototype._scaleReset=function(){var a=this._scale-this._workers.length;if(a)for(var b=a>0?a:-a,c=0;b>c;c++)a>0?this._addWorker():this._removeWorker()},h.prototype._updateProbabilities=function(a,c,d){var e=this._probabilities[0],f=this._probabilities[1],g=this._probabilities[2];b.debug(e,f,g,"×",a,c,d),e+=a,f+=c,g+=d;var h=e+f+g;e/=h,f/=h,g/=h,b.debug("->",e,f,g),this._probabilities=[e,f,g]},h.prototype._load=function(){this._scale=f.load("WorkerManager.scale",this._scale),this._rate=f.load("WorkerManager.rate",this._scale),this._probabilities=f.load("WorkerManager.probabilities",this._probabilities)},h.prototype._save=function(){f.dump("WorkerManager.scale",this._scale),f.dump("WorkerManager.rate",this._rate),f.dump("WorkerManager.probabilities",this._probabilities)},h.prototype.onPaused=function(){var a=this._workers.filter(function(a){return a.running}),b=a.length;0===b&&this._callbacks.onPaused()},h.prototype.onResult=function(a,b){this._numProblemSolved+=1,this._callbacks.onResult(a,b)},i.prototype.setProblem=function(a){this._raw.postMessage({method:"setProblem",args:[a]})},i.prototype.start=function(){this._raw.postMessage({method:"start"}),this.running=!0,this.paused=!1},i.prototype.pause=function(){this._raw.postMessage({method:"pause"})},i.prototype.terminate=function(){this._raw.terminate()},i.prototype.onResult=function(a,b){this._manager.onResult(a,b)},i.prototype.onPaused=function(){this.running=!1,this.paused=!0,this._manager.onPaused()},i.prototype._onMessage=function(a){var b=a.data,c=this[b.method];"function"==typeof c&&c.apply(this,b.args)},i.prototype._onError=function(a){b.warn("An error occurred in Worker["+this._name+"]: "+a.message+" ("+a.filename+": "+a.lineno+")")},g}]),angular.module("doshi").factory("time",function(){return function(){return Date.now()}}),angular.module("doshi").run(["$templateCache",function(a){a.put("templates/nav.html",'<ul class="nav nav-pills nav-justified hidden-print">\n  <li ng-repeat="p in pages" ng-class="{active: p.path == path}">\n    <a ng-href="/#{{p.path}}" remove-outline>\n      {{p.title}}\n      <span class="notch-wrapper"><span class="notch" ng-if="!$last"></span></span>\n    </a>\n  </li>\n</ul>\n'),a.put("templates/pagination.html",'<div class="view-pagination clearfix hidden-print">\n  <a ng-if="page.prevPage" ng-href="/#{{page.prevPage.path}}" remove-outline\n     class="btn btn-link pull-left">\n    이전 - {{page.prevPage.title}}\n  </a>\n  <a ng-if="page.nextPage" ng-href="/#{{page.nextPage.path}}" remove-outline\n     class="btn btn-primary pull-right">\n    다음 - {{page.nextPage.title}}\n  </a>\n</div>\n'),a.put("templates/progress-bar.html",'<div class="progress">\n  <div class="progress-bar" role="progressbar"\n       aria-valuenow="{{value}}" aria-valuemin="0" aria-valuemax="100"\n       ng-style="{width: value + \'%\'}">\n    <span class="sr-only">{{value}}% Complete</span>\n  </div>\n</div>\n'),a.put("views/input-step1.html",'<div class="alert alert-info">\n  <p>교과목과 반을 입력해 주세요.</p>\n  <p>\n    도움반에서 가르치는 교과목과 도움반 학생이 소속된 일반 학급을 입력하시면 됩니다.\n    어떻게 해야할지 잘 모르시겠다면\n    <a href="#" class="alert-link"\n       ng-click="loadExample(); $event.preventDefault()">예시 데이터 불러오기</a>를\n    눌러 프로그램이 어떤 식으로 작동하는지 알아보세요.\n  </p>\n</div>\n<div class="row">\n  <div class="col-sm-6">\n    <form class="form-horizontal input-courses-and-classes" ng-submit="addCourse()">\n      <div class="form-group">\n        <label for="add-course" class="col-sm-4 control-label">교과목</label>\n        <div class="col-sm-8">\n          <div class="input-group">\n            <input class="form-control" type="text" id="add-course" placeholder="예) 국어"\n                   ng-model="newCourse">\n            <span class="input-group-btn">\n              <button class="btn btn-default" type="button" ng-click="addCourse()" remove-outline>\n                +\n              </button>\n            </span>\n          </div>\n        </div>\n      </div>\n      <div class="form-group">\n        <div class="col-sm-12">\n          <ul class="list-group">\n            <li class="list-group-item" ng-repeat="course in courses">\n              <div class="list-group-item-inner">\n                {{course}}\n                <button type="button" class="close" ng-click="removeCourse(course)" remove-outline>\n                  &times;\n                </button>\n              </div>\n            </li>\n            <li class="list-group-item empty text-muted" ng-if="!courses.length">\n              <div class="list-group-item-inner">\n                입력된 교과목이 없습니다.\n              </div>\n            </li>\n          </ul>\n        </div>\n      </div>\n    </form>\n  </div>\n  <div class="col-sm-6">\n    <form class="form-horizontal input-courses-and-classes" ng-submit="addClass()">\n      <div class="form-group">\n        <label for="add-class" class="col-sm-4 control-label">반</label>\n        <div class="col-sm-8">\n          <div class="input-group">\n            <input class="form-control" type="text" id="add-class" placeholder="예) 1-1"\n                   ng-model="newClass">\n            <span class="input-group-btn">\n              <button class="btn btn-default" type="button" ng-click="addClass()" remove-outline>\n                +\n              </button>\n            </span>\n          </div>\n        </div>\n      </div>\n      <div class="form-group">\n        <div class="col-sm-12">\n          <ul class="list-group">\n            <li class="list-group-item" ng-repeat="klass in classes">\n              <div class="list-group-item-inner">\n                {{klass}}\n                <button type="button" class="close" ng-click="removeClass(klass)" remove-outline>\n                  &times;\n                </button>\n              </div>\n            </li>\n            <li class="list-group-item empty text-muted" ng-if="!classes.length">\n              <div class="list-group-item-inner">\n                입력된 반이 없습니다.\n              </div>\n            </li>\n          </ul>\n        </div>\n      </div>\n    </form>\n  </div>\n</div>\n<div ng-include="\'templates/pagination.html\'"></div>\n'),a.put("views/input-step2.html",'<div class="alert alert-info">\n  <p>시간표의 각 시간별로 도움반 수업이 필요한 반을 선택해 주세요.</p>\n  <p>\n    교과목을 선택하면 해당 시간에는 선택된 교과목만 고려됩니다.\n    교과목을 선택하지 않으면 모든 교과목이 고려됩니다.\n  </p>\n</div>\n<table class="table table-bordered timetable input-timetable">\n  <thead>\n    <tr>\n      <th></th>\n      <th>월</th>\n      <th>화</th>\n      <th>수</th>\n      <th>목</th>\n      <th>금</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr ng-repeat="period in periods">\n      <th>{{period + 1}}<span class="hidden-xs">교시</span></th>\n      <td ng-repeat="day in days"\n          ng-init="cell = inputTimetable[day][period]"\n          ng-class="{selected: cell.isSelected}"\n          ng-click="select(cell); $event.stopPropagation()">\n        <div ng-if="!cell.isSelected">\n          <div class="classes">\n            <div class="class" ng-repeat="klass in cell[0]">{{klass}}</div>\n          </div>\n          <div class="courses">\n            <div class="course" ng-repeat="course in cell[1]">{{course}}</div>\n          </div>\n        </div>\n        <div ng-if="cell.isSelected">\n          <div class="classes">\n            <div class="class"\n                 ng-repeat="klass in classes"\n                 ng-class="{selected: cell[0] &amp;&amp; cell[0].indexOf(klass) != -1}"\n                 ng-click="toggleClass(cell, klass)">{{klass}}</div>\n          </div>\n          <div class="courses">\n            <div class="course"\n                 ng-repeat="course in courses"\n                 ng-class="{selected: cell[1] &amp;&amp; cell[1].indexOf(course) != -1}"\n                 ng-click="toggleCourse(cell, course)">{{course}}</div>\n          </div>\n        </div>\n      </td>\n    </tr>\n  </tbody>\n</table>\n<div class="controls">\n  <button class="btn btn-link" ng-confirm="resetInputTimetable()">초기화</button>\n</div>\n<div ng-include="\'templates/pagination.html\'"></div>\n'),a.put("views/input-step3.html",'<div class="alert alert-info">\n  <p>기타 조건을 입력해 주세요.</p>\n  <p>\n    일부 조건은 경우에 따라 지켜지지 않을 수도 있습니다.\n  </p>\n</div>\n<form class="form-horizontal">\n  <div class="form-group">\n    <label for="max-classes" class="col-sm-3 control-label">최대 수업 크기</label>\n    <div class="col-sm-3">\n      <input type="number" id="max-classes" class="form-control" min="1" step="1"\n             pattern="\\d*"\n             ng-model="problemArgs.maxClasses">\n    </div>\n    <div class="col-sm-6">\n      <p class="help-block">\n        최대 몇 반까지 같은 수업에 배정될 수 있는 지를 설정합니다. 값을 지정하지 않으면\n        크기에 제한을 두지 않습니다.\n      </p>\n    </div>\n  </div>\n  <div class="form-group">\n    <label for="course-hours" class="col-sm-3 control-label">주당 수업 시간</label>\n    <div class="col-sm-3">\n      <input type="number" id="course-hours" class="form-control" min="1" step="1"\n             pattern="\\d*"\n             ng-model="problemArgs.courseHours">\n    </div>\n    <div class="col-sm-6">\n      <p class="help-block">\n        각 교과목마다 일주일에 몇 시간의 수업 시간을 넣을지를 설정합니다.\n        값을 지정하지 않으면 수업 시간이 적은 시간표가 만들어집니다.\n      </p>\n    </div>\n  </div>\n  <div ng-if="problemArgs.courses.length">\n    <h2>교과목별 수업 시간</h2>\n    <p class="help-block">\n      각 교과목별로 주당 수업 시간을 설정합니다. 값을 지정하지 않으면 위에서 입력한 주당 수업 시간이\n      적용됩니다.\n    </p>\n    <div class="form-group" ng-repeat="course in problemArgs.courses">\n      <label for="course-hours-{{$index}}" class="col-sm-3 control-label">{{course}}</label>\n      <div class="col-sm-3">\n        <input type="number" id="course-hours" class="form-control" min="1" step="1"\n               pattern="\\d*"\n               ng-model="problemArgs.courseHoursByCourse[course]">\n      </div>\n    </div>\n  </div>\n</form>\n<div ng-include="\'templates/pagination.html\'"></div>\n'),a.put("views/output.html",'<div class="alert alert-warning" ng-if="status.emptyInput">\n  입력된 정보가 부족합니다. <a class="alert-link" href="/#/input-times">시간 입력</a>\n  단계에서 반을 선택해 주세요.\n</div>\n<div class="alert alert-info hidden-print" ng-if="status.showHelp &amp;&amp; !status.emptyInput">\n  버튼을 누르면 시간표 만들기를 시작합니다.\n  컴퓨터 사양에 따라 1분에서 5분 정도 걸릴 수 있습니다.\n</div>\n<div skip-ng-animate>\n  <div class="controls hidden-print" ng-if="!status.emptyInput">\n    <button class="btn btn-success" remove-outline\n            ng-if="status.finished || (status.paused &amp;&amp; status.inputChanged)"\n            ng-click="start()">\n      <span ng-if="!status.inputChanged &amp;&amp; !timetable.length">시간표 만들기</span>\n      <span ng-if="!status.inputChanged &amp;&amp; timetable.length">새 시간표 만들기</span>\n      <span ng-if="status.inputChanged">바뀐 설정으로 시간표 만들기</span>\n    </button>\n    <button class="btn btn-default" remove-outline\n            ng-if="status.starting || status.running"\n            ng-disabled="status.starting"\n            ng-click="pause()">일시 정지</button>\n    <button class="btn btn-default" remove-outline\n            ng-if="status.pausing || status.paused"\n            ng-disabled="status.pausing"\n            ng-click="resume()">실행 재개</button>\n    <span class="controls-progress-label" ng-if="!status.finished">\n      {{status.progress.percent | number:1}}% 완료\n    </span>\n    <i class="fa fa-spinner fa-spin" ng-if="status.starting || status.running || status.pausing"></i>\n  </div>\n</div>\n<div progress-bar model="status.progress.percent" ng-if="!status.finished"></div>\n<div class="alert alert-warning" ng-if="timetable.length &amp;&amp; status.inputChanged">\n  아래 시간표는 과거에 만들어진 것입니다. 시간표를 만들었을 당시의 설정값은 현재 설정값과 다를 수 있습니다.\n</div>\n<div ng-if="timetable.length">\n  <table class="table table-bordered timetable output-timetable">\n    <thead>\n      <tr>\n        <th></th>\n        <th>월</th>\n        <th>화</th>\n        <th>수</th>\n        <th>목</th>\n        <th>금</th>\n      </tr>\n    </thead>\n    <tbody>\n      <tr ng-repeat="period in periods">\n        <th>{{period + 1}}<span class="hidden-xs">교시</span></th>\n        <td ng-repeat="day in days"\n            ng-init="assignments = timetable[day][period]">\n          <table class="course-classes" maximize-height watch="timetable">\n            <tr ng-repeat="assignment in assignments"\n                ng-init="course = assignment[0]; classes = assignment[1]">\n              <td ng-class="{highlight: assignment.isHighlighted}">\n                <div class="course"\n                     ng-click="highlightCourse(course); $event.stopPropagation()"\n                     ng-class="{highlight: course == highlightedCourse}">\n                  {{course}}\n                </div>\n                <div class="classes">\n                  <div class="class" ng-repeat="klass in classes"\n                       ng-click="highlightClass(klass); $event.stopPropagation()"\n                       ng-class="{highlight: klass == highlightedClass}">\n                    {{klass}}\n                  </div>\n                </div>\n              </td>\n            </tr>\n          </table>\n        </td>\n      </tr>\n    </tbody>\n  </table>\n  <h2>수업 시간 통계</h2>\n  <div class="row">\n    <div class="col-sm-6">\n      <table class="table table-bordered">\n        <thead>\n          <tr>\n            <th></th>\n            <th>월</th>\n            <th>화</th>\n            <th>수</th>\n            <th>목</th>\n            <th>금</th>\n            <th>합계</th>\n          </tr>\n        </thead>\n        <tbody>\n          <tr ng-repeat="(course, days) in timetableStats.daysByCourse">\n            <th>{{course}}</th>\n            <td ng-repeat="(day, hours) in days">{{hours}}</td>\n            <td>{{timetableStats.sumDaysByCourse[course]}}</td>\n          </tr>\n        </tbody>\n      </table>\n    </div>\n    <div class="col-sm-6">\n      <table class="table table-bordered">\n        <thead>\n          <tr>\n            <th></th>\n            <th ng-repeat="(course, _) in timetableStats.daysByCourse">{{course}}</th>\n            <th>합계</th>\n          </tr>\n        </thead>\n        <tbody>\n          <tr ng-repeat="(klass, courses) in timetableStats.coursesByClass">\n            <th>{{klass}}</th>\n            <td ng-repeat="(course, hours) in courses">{{hours}}</td>\n            <td>{{timetableStats.sumCoursesByClass[klass]}}</td>\n          </tr>\n        </tbody>\n      </table>\n    </div>\n  </div>\n</div>\n<div ng-include="\'templates/pagination.html\'"></div>\n')
}]);